version: '3.8'

# Docker Compose configuration for MongoDB Atlas
# This file uses MongoDB Atlas instead of local MongoDB container

services:
  frontend:
    build: ./frontend
    container_name: frontend-app
    depends_on:
      - backend
    networks:
      - app-network
    ports:
      - "80:80"

  backend:
    build: ./backend
    container_name: backend-app
    environment:
      # MongoDB Atlas Connection String
      - MONGODB_URI=${MONGODB_URI}
      # JWT Secret
      - JWT_SECRET=${JWT_SECRET}
      # CORS Allowed Origins
      - CORS_ALLOWED_ORIGINS=${CORS_ALLOWED_ORIGINS:-http://localhost:4200}
      # Admin User Initialization (disable after first run)
      - INIT_ADMIN_ENABLED=${INIT_ADMIN_ENABLED:-false}
      - INIT_ADMIN_USERNAME=${INIT_ADMIN_USERNAME:-admin}
      - INIT_ADMIN_PASSWORD=${INIT_ADMIN_PASSWORD:-}
    ports:
      - "8080:8080"
    networks:
      - app-network
    # No dependency on mongo service since we're using Atlas

networks:
  app-network:
    driver: bridge

# Usage:
# 1. Create a .env file in the project root with:
#    MONGODB_URI=mongodb+srv://username:password@cluster0.xxxxx.mongodb.net/sara?retryWrites=true&w=majority
#    JWT_SECRET=your-jwt-secret-key
#    CORS_ALLOWED_ORIGINS=http://localhost:4200,https://www.servicesarkari.com
#    INIT_ADMIN_ENABLED=true
#    INIT_ADMIN_USERNAME=admin
#    INIT_ADMIN_PASSWORD=your-password
#
# 2. Run: docker-compose -f docker-compose.atlas.yml up --build

